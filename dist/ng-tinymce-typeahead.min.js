/** 
* @license ng-tinymce-typeahead - v0.0.8
* (c) 2014 Julien VALERY https://github.com/darul75/ng-tinymce-typeahead
* License: MIT 
**/
angular.module("ui.tinymce.typeahead",["siyfion.sfTypeahead","ui.tinymce.typeahead.factory"]).constant("constants",{type:{link:"link",image:"image"},completeOptions:{highlight:!0}}).directive("uiTinymceLinkerMenu",["$timeout","typeaheadFactory","constants",function(a,b,c){return{template:'<div ng-show="showMenu"><ul class="dropdown-menu" style="display:block;position:absolute;z-index: 1070;top:{{top}}px;left:{{left}}px;width:300px"><li class="dropdown-header" ng-if="ariane && ariane.length > 0"><button class="btn btn-default btn-xs" ng-repeat="menu in ariane" href="#" ng-click="clickMenu(menu)">{{menu.label}}</button></li><li ng-repeat="menu in menus" ng-show="!menu.inactive"><a href="#" ng-click="clickMenu(menu)"><span ng-if="menu.icon" class="glyphicon {{menu.icon}}"></span> {{menu.label}}</a></li></ul><div ng-if="resultsDataset" style="display:block;position:absolute;z-index: 1070;top:{{top}}px;left:{{left}}px;width:350px" class="panel panel-default"><div class="panel-heading text-center"><span class="label label-primary" ng-repeat="menu in ariane">{{menu.label}}</span></div><div class="panel-body"><div class="input-group"><input type="text" placeholder="Search..." class="form-control" sf-typeahead options="constants.completeOptions" datasets="resultsDataset" ng-model="selectedLink.result" style="width:270px"><span class="input-group-btn"><button type="button" class="btn btn-success" ng-click="select()"><span class="glyphicon glyphicon-plus"></span></button></span></div></div></div><div>',scope:{menu:"=",service:"="},link:function(d,e,f){var g=angular.isDefined;if(g(f.menu)&&g(f.service)){var h=angular.injector([d.service.module,"ng"]);d.serviceDelegator=h.get(d.service.name);var i=c.type.link,j=c.type.image;d.init=function(){d.selectedLink={result:""},k(d.menu,null),d.originalMenu=angular.copy(d.menu),d.ariane=[]},d.clickMenu=function(a){d.ariane.indexOf(a)<0&&d.ariane.push(a),a.children?(d.showOptions=!1,d.showAutoComplete=!1,d.showMenu=!0,d.menus=a.children,d.activeMenuItem=void 0,d.showAutoComplete=!1):(d.activeMenuItem=a,d.label=a.label,d.showOptions=!1,d.showMenu=!1,d.showAutoComplete=!0,d.fetch())},d.fetch=function(){var c=function(c){a(function(){d.resultsDataset=b.GetResultDatasets(c),d.showMenu=!0})};d.activeMenuItem.type===i?d.serviceDelegator[d.service.methodLinks](d.activeMenuItem,"test").then(function(a){c(a)}):d.activeMenuItem.type===j&&d.serviceDelegator[d.service.methodImage](d.activeMenuItem,"test").then(function(a){c(a)})},d.select=function(){var b=tinymce.activeEditor,c=b.dom,e=b.selection.getContent(),f=d.selectedLink.result.url,g=d.selectedLink.result.label,h={target:"_blank",title:g,href:f};switch(d.selectedLink.result.type){case i:e?tinymce.execCommand("mceInsertLink",!1,f):b.insertContent(c.createHTML("a",h,c.encode(h.title)));break;case j:var k=b.selection.getRng(),l=b.getDoc().createElement("img");l.src=f,k.insertNode(l)}a(function(){b.fire("SetContent")},3e3),d.showMenu=!1,d.ariane=[],d.selectedLink={result:""},d.menus=d.originalMenu},d.selectAdvanced=function(){var a=d.selectedLink.result.url,b=d.selectedLink.result.label;switch(d.selectedLink.result.type){case i:var c=[{value:"_blank",link:a,title:b}];d.showMenu=!1;{tinymce.activeEditor.plugins.link.showDialog(c)}break;case j:var e=ed.selection.getRng(),f=ed.getDoc().createElement("img");f.src=a,e.insertNode(f)}d.showMenu=!1,d.ariane=[],d.selectedLink={result:""},d.menus=d.originalMenu},d.initListeners=function(){d.left=0,d.top=0;var b=!1,e=17,f=32;tinymce.on("AddEditor",function(g){d.pluginLink=!!tinymce.AddOnManager.PluginManager.get(c.type.link),d.pluginImage=!!tinymce.AddOnManager.PluginManager.get(c.type.image),(d.linkPlugin||d.pluginImage)&&(d.init(),g.editor.on("click",function(){a(function(){d.showMenu=!1,d.ariane=[]})}),g.editor.on("keydown",function(a){if((a.keyCode===e||a.ctrlKey||a.metaKey)&&(b=!0),b&&a.keyCode===f&&a.preventDefault(),b&&a.keyCode===f){b=!1;var c=tinyMCE.activeEditor,g=$(c.getContainer()),h=c.selection,i=g.position(),j=g.find(".mce-toolbar").first(),k=$(h.getNode()).position(),l=0,m=0;c.selection.getRng().getClientRects().length>0?(l=h.getRng().getClientRects()[0].top+h.getRng().getClientRects()[0].height,m=h.getRng().getClientRects()[0].left):(l=1.3*parseInt($(this.selection.getNode()).css("font-size"),10)+k.top,m=k.left);var n=g.offset(),o={top:i.top+j.innerHeight()+l,left:i.left+m+n.left};d.left=o.left+10,d.top=o.top+5,d.showMenu=!0,d.resultsDataset=null}}),g.editor.on("mousedown",function(){d.showMenu=!1,d.menus=d.originalMenu}))})};var k=function(a,b){for(var c=0;c<a.length;c++){var e=a[c];if(e.children&&k(e.children,e),e.type&&!d.pluginLink&&e.type===i){b.inactive=!0;break}if(e.type&&!d.pluginImage&&e.type===j){b.inactive=!0;break}}};d.initListeners()}}}}]),angular.module("ui.tinymce.typeahead.factory",[]).factory("typeaheadFactory",[function(){var a={};return a.GetResultDatasets=function(a){var b=new Bloodhound({datumTokenizer:function(a){return Bloodhound.tokenizers.whitespace(a.label)},queryTokenizer:Bloodhound.tokenizers.whitespace,local:[]});return b.local=a,b.initialize(),{displayKey:"label",source:b.ttAdapter()}},a.InitTinymce=function(){},a}]);